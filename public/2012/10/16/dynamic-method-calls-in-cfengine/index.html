<!DOCTYPE html>
<html>

    <head>
        <title> Dynamic method calls in CFEngine &middot;  </title>

        <meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Hugo 0.92.2" />




<script src="https://code.jquery.com/jquery-3.1.1.min.js"   integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8="   crossorigin="anonymous"></script>


<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-+0n0xVW2eSR5OomGNYDnhzAbDsOXxcvSN1TPprVMTNDbiYZCxYbOOl7+AMvyTG2x" crossorigin="anonymous">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/js/bootstrap.bundle.min.js" integrity="sha384-gtEjrD/SeCtmISkJkNUaaKMoLD0//ElJ19smozuHV6z3Iehds+3Ulb9Bn9Plx0x4" crossorigin="anonymous"></script>


<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">


<link rel="stylesheet" href="https://cmdln.org/css/nix.css">





<link href="https://fonts.googleapis.com/css?family=Inconsolata%7COpen+Sans%7CConcert+One" rel="stylesheet">






    </head>

    <body>
        <header>
	<nav class="navbar navbar-dark bg-dark fixed-top navbar-expand-lg font-header">
		<div class="container-fluid">
			<a class="navbar-brand" id="green-terminal" href='https://cmdln.org/'>
				nick@cmdln.org ~ $
			</a>
			<button type="button" class="navbar-toggler" data-bs-toggle="collapse" data-bs-target="#navbar-collapse-1" 
					aria-controls="navbar-collapse-1" aria-expanded="false">
				<span class="visually-hidden">Toggle navigation</span>
				<span class="navbar-toggler-icon"></span>
			</button>
	
			
			<div class="collapse navbar-collapse" id="navbar-collapse-1">
				<ul class="nav navbar-nav ms-auto">
					<li class="nav-item">
						<a class="nav-link" href='https://cmdln.org/'>
							/home/nick</a>
					</li>
					
					
					
					<li class="nav-item dropdown">
						
						<a class="nav-link" href="https://cmdln.org/post/">~/posts</a>
						
					</li>
					
				</ul>
			</div>
		</div>
	</nav>
</header>

        <div class="flex-wrapper">
            <div class="container wrapper">
                <h1><a href="https://cmdln.org/2012/10/16/dynamic-method-calls-in-cfengine/">Dynamic method calls in CFEngine</a></h1>
                <span class="post-date">2012-10-16 </span>
                <div class="post-content">
                    <p><a href="http://www.cmdln.org/images/wp-content/uploads/2012/10/dynamic.jpg"><!-- raw HTML omitted --></a>Methods type promises are powerful abstraction tools in CFEngine 3. Methods allow you to activate bundles (optionally parametrized) from other bundles. This allows encapsulation of knowledge and lends itself to re-usability.</p>
<p>I just want to share an example of calling bundles dynamically. It’s a contrived example, but I thought it was neat so here it is.</p>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<pre><code>  &lt;div class=&quot;gist-meta&quot;&gt;
    &lt;a href=&quot;https://gist.github.com/raw/3901453/0b683269921c056b4e821dd2c63ca6b622122e26/output&quot; style=&quot;float:right;&quot;&gt;view raw&lt;/a&gt; &lt;a href=&quot;https://gist.github.com/3901453#file_output&quot; style=&quot;float:right;margin-right:10px;color:#666&quot;&gt;output&lt;/a&gt; &lt;a href=&quot;https://gist.github.com/3901453&quot;&gt;This Gist&lt;/a&gt; is brought to you using &lt;a href=&quot;http://en.bainternet.info/2011/simple-gist-embed&quot;&gt;&lt;small&gt;Simple Gist Embed&lt;/small&gt;&lt;/a&gt;.
  &lt;/div&gt;
&lt;/div&gt;

&lt;div class=&quot;gist-file&quot;&gt;
  &lt;div class=&quot;gist-data gist-syntax&quot;&gt;
    &lt;div class=&quot;highlight&quot;&gt;
      &lt;pre&gt;&lt;div class='line' id='LC1'&gt;
</code></pre>
<p>body common control {</p>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<pre><code>  &lt;div class=&quot;gist-meta&quot;&gt;
    &lt;a href=&quot;https://gist.github.com/raw/3901453/67c8bda449460da4d5b8c1983d5b0bbaacc63b13/test.cf&quot; style=&quot;float:right;&quot;&gt;view raw&lt;/a&gt; &lt;a href=&quot;https://gist.github.com/3901453#file_test.cf&quot; style=&quot;float:right;margin-right:10px;color:#666&quot;&gt;test.cf&lt;/a&gt; &lt;a href=&quot;https://gist.github.com/3901453&quot;&gt;This Gist&lt;/a&gt; is brought to you using &lt;a href=&quot;http://en.bainternet.info/2011/simple-gist-embed&quot;&gt;&lt;small&gt;Simple Gist Embed&lt;/small&gt;&lt;/a&gt;.
  &lt;/div&gt;
&lt;/div&gt;
</code></pre>
<!-- raw HTML omitted -->
<h4 id="breakdown">Breakdown</h4>
<h5 id="bundle-agent-main">bundle agent main</h5>
<p>Here we define two lists, a list of bundle names and a list of values. Because of implicit list iteration we then call “handler_iterator” 2 times. Once for each value of the mybundles list. Each activation also passes in the myvalues list.</p>
<h5 id="bundle-agent-handler_iterator">Bundle agent handler_iterator</h5>
<p>handler_iterator is where the neat part happens. You can see that we call the bundle $(handler) (outside of quotes) with the parameter @(handler_iterator.values). This is what I found so interesting. I Have called bundles dynamically in the past, but I have always put the variable inside of quotes. That worked fine but it prevented me from using parameters when calling because the parameters were seen as part of the bundle name.  Here is an example of the handler_iterator bundle trying to use a parametrized value inside of quotes.</p>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<pre><code>  &lt;div class=&quot;gist-meta&quot;&gt;
    &lt;a href=&quot;https://gist.github.com/raw/3901469/68b0a864b987496cdd8d936bb5d8777ca6fc6f6a/example%20of%20bundle%20inside%20quotes&quot; style=&quot;float:right;&quot;&gt;view raw&lt;/a&gt; &lt;a href=&quot;https://gist.github.com/3901469#file_example of bundle inside quotes&quot; style=&quot;float:right;margin-right:10px;color:#666&quot;&gt;example of bundle inside quotes&lt;/a&gt; &lt;a href=&quot;https://gist.github.com/3901469&quot;&gt;This Gist&lt;/a&gt; is brought to you using &lt;a href=&quot;http://en.bainternet.info/2011/simple-gist-embed&quot;&gt;&lt;small&gt;Simple Gist Embed&lt;/small&gt;&lt;/a&gt;.
  &lt;/div&gt;
&lt;/div&gt;

&lt;div class=&quot;gist-file&quot;&gt;
  &lt;div class=&quot;gist-data gist-syntax&quot;&gt;
    &lt;div class=&quot;highlight&quot;&gt;
      &lt;pre&gt;&lt;div class='line' id='LC1'&gt;
</code></pre>
<p> !! A method attempted to use a bundle &ldquo;handler1(value1)&rdquo; that was apparently not defined!</p>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<pre><code>  &lt;div class=&quot;gist-meta&quot;&gt;
    &lt;a href=&quot;https://gist.github.com/raw/3901469/718fbe133ea02c04d6d55badaf599f90fdc7679b/output&quot; style=&quot;float:right;&quot;&gt;view raw&lt;/a&gt; &lt;a href=&quot;https://gist.github.com/3901469#file_output&quot; style=&quot;float:right;margin-right:10px;color:#666&quot;&gt;output&lt;/a&gt; &lt;a href=&quot;https://gist.github.com/3901469&quot;&gt;This Gist&lt;/a&gt; is brought to you using &lt;a href=&quot;http://en.bainternet.info/2011/simple-gist-embed&quot;&gt;&lt;small&gt;Simple Gist Embed&lt;/small&gt;&lt;/a&gt;.
  &lt;/div&gt;
&lt;/div&gt;
</code></pre>
<!-- raw HTML omitted -->
<p>Since $(handler) is a single value (we iterated over the list of bundles in bundle agent main) only one method activation will happen for each activation of handler_iterator.</p>
<h5 id="bundle-agent-handlerx">bundle agent handlerx</h5>
<p>The handlers themselves just report once for each item in the list passed to them.</p>
<h5 id="specific-use-case">Specific Use Case</h5>
<p>Well, I don’t have one. I can however imagine that based on some variable event you might want to call a bundle with some variable parameter. Something like the <!-- raw HTML omitted -->nagios_plugin_agent<!-- raw HTML omitted --> sketch comes to mind. (It can call a variable bundle right now).</p>

                </div>
                
                <div class="post-comments">
                    
                </div>
                
            </div>
            <footer class="footer text-center">
<p>Copyright &copy; 2024 Nick Anderson -
<span class="credit">
	Powered by
	<a target="_blank" href="https://gohugo.io">Hugo</a>
	and
	<a target="_blank" href="https://github.com/LordMathis/hugo-theme-nix/">Nix</a> theme.
</span>
</p>
</footer>

        </div>
    </body>
